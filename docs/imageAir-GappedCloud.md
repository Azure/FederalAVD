[**Home**](../README.md) | [**Design**](design.md) | [**Get Started**](quickStart.md) | [**Troubleshooting**](troubleshooting.md) | [**Parameters**](parameters.md) | [**Scope**](scope.md) | [**Zero Trust Framework**](zeroTrustFramework.md)

# Air-Gapped Cloud Custom Image Build Considerations

The air-gapped clouds, USNat and USSec, offer unique challenges because not all software is available for download via http and where it is it may not be available to all enclaves on the networks these clouds service.

The following table provides specific instructions for preparing your air-gapped environment for building custom images. This assumes that you have already created the image management storage account and blob container. The **Storage Account Provided** and **Download Latest Microsoft Content** columns represent the `artifactsContainerUri` and the `downloadLatestMicrosoftContent` image build parameters respectively.

| Software | Storage Account</br>Provided | Download Latest</br>Microsoft Content | Instructions and Caveats |
|:--|:--:|:--:|:--|
| FSLogix | Yes | Yes / No | <ol><li>On a system with access to the public Internet, download the latest agent at [aka.ms/fslogix_download](https://aka.ms/fslogix_download).</li><li>Transfer it to the air-gapped cloud and save it as **FSLogix.zip** in the storage account and container specified.</li></ol> |
| FSLogix | No | Yes / No | T<span style="color:red">Not supported</span> |
| Office | Yes | No | On your air-gapped management system, execute [Deploy-ImageManagement.ps1](quickStart.md#deploy-image-management-resources) or download [USSec ODT Setup.exe](https://officexo.azurefd.microsoft.scloud/prsstelecontainer/wsus/setup.exe) or [USNat ODT Setup.exe](https://officexo.azurefd.eaglex.ic.gov/prsstelecontainer/wsus/setup.exe) and save it to the blob storage container as **Office365DeploymentTool.exe**. |
| Office | Yes / No | Yes | The [USSec ODT Setup.exe](https://officexo.azurefd.microsoft.scloud/prsstelecontainer/wsus/setup.exe) or [USNat ODT Setup.exe](https://officexo.azurefd.eaglex.ic.gov/prsstelecontainer/wsus/setup.exe) url must be accessible from the image build virtual machine. |
| OneDrive | Yes | No |  On your air-gapped management system, execute [Deploy-ImageManagement.ps1](quickStart.md#deploy-image-management-resources) or download [USSec OneDriveSetup.exe](https://update.azure.odsync.microsoft.scloud/onedrivecontainer/Win/Installer64/OneDriveSetup.exe) or [USNat OneDriveSetup.exe](https://update.azure.odsync.eaglex.ic.gov/onedrivecontainer/Win/Installer64/OneDriveSetup.exe) and save it as **OneDriveSetup.exe** in the blob container.|
| OneDrive | Yes / No | Yes | The [USSec OneDriveSetup.exe](https://update.azure.odsync.microsoft.scloud/onedrivecontainer/Win/Installer64/OneDriveSetup.exe) or [USNat OneDriveSetup.exe](https://update.azure.odsync.eaglex.ic.gov/onedrivecontainer/Win/Installer64/OneDriveSetup.exe) url must be accessible from the image build virtual machine. |
| Teams | Yes | No | <ol><li>On a system with access to the public Internet:</br><ul><li>Download the latest [WebView2 Runtime](https://go.microsoft.com/fwlink/?linkid=2124703) and save it as **WebView2.exe**</li><li>Download the lastest [Visual Studio Redistributables](https://aka.ms/vs/17/release/vc_redist.x64.exe) and save it as **vc_redist.x64.exe**.</li><li>Download the latest [Remote Desktop Web RTC Service installer](https://aka.ms/msrdcwebrtcsvc/msi) and save it as **MsRdcWebRTCSvc.msi**.</li></ul><li>Transfer all three files to the air-gapped network and upload them to the storage account blob container.</li><li>On your air-gapped management system, execute [Deploy-ImageManagement.ps1](quickStart.md#deploy-image-management-resources) or  download:<ul><li>The latest Teams Bootstrapper from [USSec Teams Bootstrapper](https://statics.teams.microsoft.scloud/production-teamsprovision/lkg/teamsbootstrapper.exe) or [USNat Teams Bootstrapper](https://statics.teams.eaglex.ic.gov/production-teamsprovision/lkg/teamsbootstrapper.exe) and upload it to the storage blob container as **teamsbootstrapper.exe**.</li><li>The latest Teams 64-bit MSIX file from [USSec Teams MSIX file](https://statics.teams.microsoft.scloud/production-windows-x64/enterprise/webview2/lkg/MSTeams-x64.msix) or [USNat Teams MSIX file](https://statics.teams.eaglex.ic.gov/production-windows-x64/enterprise/webview2/lkg/MSTeams-x64.msix) and upload it to the storage blob container as **MSTeams-x64.msix**.</li></ul></ol> |
| Teams | Yes | Yes | <ol><li>On a system with access to the public Internet:</br><ul><li>Download the latest [WebView2 Runtime](https://go.microsoft.com/fwlink/?linkid=2124703) and save it as **WebView2.exe**.</li><li>Download the lastest [Visual Studio Redistributables](https://aka.ms/vs/17/release/vc_redist.x64.exe) and save it as **vc_redist.x64.exe**.</li><li>Download the latest [Remote Desktop Web RTC Service installer](https://aka.ms/msrdcwebrtcsvc/msi) and save it as **MsRdcWebRTCSvc.msi**.</li></ul><li>Transfer all three files to the air-gapped network and upload them to the storage account blob container.</li><li>Ensure that the image build virtual machine can access The latest Teams Bootstrapper from [USSec Teams Bootstrapper](https://statics.teams.microsoft.scloud/production-teamsprovision/lkg/teamsbootstrapper.exe) or [USNat Teams Bootstrapper](https://statics.teams.eaglex.ic.gov/production-teamsprovision/lkg/teamsbootstrapper.exe) and the latest Teams 64-bit MSIX file from [USSec Teams MSIX file](https://statics.teams.microsoft.scloud/production-windows-x64/enterprise/webview2/lkg/MSTeams-x64.msix) or [USNat Teams MSIX file](https://statics.teams.eaglex.ic.gov/production-windows-x64/enterprise/webview2/lkg/MSTeams-x64.msix) |
| Teams | No | Yes | Ensure that the image build virtual machine can access The latest Teams Bootstrapper from [USSec Teams Bootstrapper](https://statics.teams.microsoft.scloud/production-teamsprovision/lkg/teamsbootstrapper.exe) or [USNat Teams Bootstrapper](https://statics.teams.eaglex.ic.gov/production-teamsprovision/lkg/teamsbootstrapper.exe) and the latest Teams 64-bit MSIX file from [USSec Teams MSIX file](https://statics.teams.microsoft.scloud/production-windows-x64/enterprise/webview2/lkg/MSTeams-x64.msix) or [USNat Teams MSIX file](https://statics.teams.eaglex.ic.gov/production-windows-x64/enterprise/webview2/lkg/MSTeams-x64.msix). **Note:**<span style="color:red">Teams media optimizations will not be enabled in this scenario.</span> |
| Teams | No | No | <span style="color:red">Not supported</span> |
| VDOT | Yes | Yes / No | <ol><li>On a system with access to the public Internet, download the latest [VDOT](https://github.com/The-Virtual-Desktop-Team/Virtual-Desktop-Optimization-Tool/archive/refs/heads/main.zip) and save it as **VDOT.zip**.</li><li>Transfer it to an air-gapped system and upload it to the storage account container. |

## References

### USSec

[Microsoft 365 Apps](https://review.learn.microsoft.com/en-us/microsoft-365-ussec/deployoffice/deployment-guide-microsoft-365-apps?branch=live)
[Microsoft OneDrive](https://review.learn.microsoft.com/en-us/microsoft-365-ussec/onedrive/deploy-m365-onedrive-in-ussec?branch=live)
[Microsoft Teams](https://review.learn.microsoft.com/en-us/microsoft-365-ussec/teams/install-teams?branch=live)

### USNat

[Microsoft 365 Apps](https://review.learn.microsoft.com/en-us/microsoft-365-usnat/deployoffice/deployment-guide-microsoft-365-apps?branch=live)
[Microsoft OneDrive](https://review.learn.microsoft.com/en-us/microsoft-365-usnat/onedrive/deploy-m365-onedrive-in-usnat?branch=live)
[Microsoft Teams](https://review.learn.microsoft.com/en-us/microsoft-365-usnat/teams/install-teams?branch=live)