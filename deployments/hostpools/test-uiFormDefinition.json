{
	"$schema": "https://schema.management.azure.com/schemas/2021-09-09/uiFormDefinition.schema.json",
	"view": {
		"kind": "Form",
		"properties": {
			"title": "Test",
			"steps": [
				{
					"name": "basics",
					"label": "Basics",
					"elements": [
						{
							"name": "scope",
							"type": "Microsoft.Common.ResourceScope",
							"instanceDetailsLabel": "Session Host Replacer Deployment Details",
							"location": {
								"label": "Region",
								"toolTip": "Select the region where the Session Host Replacer function app and supporting resources will be deployed."
							}
						},						
						{
							"name": "hostPoolSelector",
							"type": "Microsoft.Solutions.ResourceSelector",
							"label": "Select Host Pool",
							"toolTip": "Select an existing AVD host pool to test API retrieval",
							"resourceType": "Microsoft.DesktopVirtualization/hostpools",
							"constraints": {
								"required": true
							}
						},
                        {
							"name": "hostPoolApi",
							"type": "Microsoft.Solutions.ArmApiControl",
                            "condition": "not(empty(steps('basics').hostPoolSelector))",
							"request": {
								"method": "GET",
								"path": "[concat(steps('basics').hostPoolSelector.id, '?api-version=2024-04-03')]"
							}
						},
						{
							"name": "apiCheck",
							"type": "Microsoft.Common.TextBlock",
							"visible": true,
							"options": {
								"text": "[concat('API Status - Control Empty: ', string(empty(steps('basics').hostPoolApi)), ' | vmTemplate Empty: ', if(empty(steps('basics').hostPoolApi), 'N/A', string(empty(steps('basics').hostPoolApi.properties.vmTemplate))))]"
							}
						},
						{
							"name": "apiVmTemplateRaw",
							"type": "Microsoft.Common.TextBlock",
							"visible": "[not(empty(steps('basics').hostPoolApi))]",
							"options": {
								"text": "[concat('=== RAW vmTemplate from API ===\n', steps('basics').hostPoolApi.properties.vmTemplate)]"
							}
						},
						{
							"name": "stringTestCloudOnly",
							"type": "Microsoft.Common.TextBlock",
							"visible": "[not(empty(steps('basics').hostPoolApi))]",
							"options": {
								"text": "[concat('String contains \"EntraKerberos-CloudOnly\": ', string(contains(steps('basics').hostPoolApi.properties.vmTemplate, 'EntraKerberos-CloudOnly')))]"
							}
						},
						{
							"name": "stringTestHybrid",
							"type": "Microsoft.Common.TextBlock",
							"visible": "[not(empty(steps('basics').hostPoolApi))]",
							"options": {
								"text": "[concat('String contains \"EntraKerberos-Hybrid\": ', string(contains(steps('basics').hostPoolApi.properties.vmTemplate, 'EntraKerberos-Hybrid')))]"
							}
						}
					]
				}
			]
		},
		"outputs": {
			"parameters": {
				"hostPoolId": "[steps('basics').hostPoolSelector.id]",
				"vmTemplateRaw": "[steps('basics').hostPoolApi.properties.vmTemplate]",
				"containsCloudOnly": "[contains(steps('basics').hostPoolApi.properties.vmTemplate, 'EntraKerberos-CloudOnly')]",
				"containsHybrid": "[contains(steps('basics').hostPoolApi.properties.vmTemplate, 'EntraKerberos-Hybrid')]"
			},
			"kind": "Subscription",
			"location": "[steps('basics').scope.location.name]",
			"subscriptionId": "[steps('basics').scope.subscription.id]"
		}
	}
}